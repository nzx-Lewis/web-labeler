var b=Object.defineProperty;var g=(o,e,t)=>e in o?b(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t;var s=(o,e,t)=>g(o,typeof e!="symbol"?e+"":e,t);class f{constructor(e=[],t=null){s(this,"matchLabel",e=>{var t;if((e==null?void 0:e.isActive)!==!0||!Array.isArray(e==null?void 0:e.labels)||((t=e==null?void 0:e.labels)==null?void 0:t.length)===0)return null;for(const i of e.labels)if(i.isActive){for(const n of i.rules)if(this.checkRule(n.type,n.value,window.location.hostname))return i}return null});s(this,"checkRule",(e,t,i)=>{switch(e){case"matches":return i==t;case"startsWith":return i.startsWith(t);case"endsWith":return i.endsWith(t);case"contains":return i.includes(t);default:return!1}});this.subscribers=e,this.label=t}async init(){chrome.storage.sync.onChanged.addListener(this.handleStorageChange.bind(this));const{options:e}=await chrome.storage.sync.get("options");this.label=this.matchLabel(e),this.notifySubscribers()}handleStorageChange(e){this.label=this.matchLabel(e.options.newValue),this.notifySubscribers()}subscribe(e){this.subscribers.push(e)}notifySubscribers(){this.subscribers.forEach(e=>e(this.label))}}const u="_label_chhx4_1",z="_frame_chhx4_34",v="_hovered_chhx4_34",y="_ribbon_chhx4_37",k="_triangle_chhx4_61",p="_banner_chhx4_89",T="_block_chhx4_118",r={label:u,frame:z,hovered:v,ribbon:y,"left-top":"_left-top_chhx4_41","right-top":"_right-top_chhx4_46","left-bottom":"_left-bottom_chhx4_51","right-bottom":"_right-bottom_chhx4_56",triangle:k,banner:p,block:T};class w{constructor(e=null,t=null){s(this,"hoverHandler",e=>{if(!this.element)return;const{left:t,top:i,width:n,height:l}=this.element.getBoundingClientRect();e.clientX>=t&&e.clientX<=t+n&&e.clientY>=i&&e.clientY<=i+l?this.element.classList.add(r.hovered):this.element.classList.remove(r.hovered)});this.element=e,this.hoverListener=t}update(e){this.remove(),e&&this.render(e)}render(e){this.element=document.createElement("div"),this.element.className=r.label,this.element.classList.add(r==null?void 0:r[e.shape]),this.element.classList.add(r==null?void 0:r[e.position]),this.element.innerHTML=e.shape==="frame"?"":e.name.replace(/\r\n|\r|\n/g,"<br>"),this.element.style.setProperty("--label-text-color",e.textColor),this.element.style.setProperty("--label-opacity",String(e.opacity)),this.element.style.setProperty("--label-background-color",e.bgColor),(e==null?void 0:e.hoveredOpacity)!==void 0&&this.element.style.setProperty("--label-hovered-opacity",String(e.hoveredOpacity)),e.fontSize&&this.element.style.setProperty("--label-font-size",String(e.fontSize)+"px"),e!=null&&e.scale&&this.element.style.setProperty("--label-scale",String(e.scale)),e!=null&&e.border&&this.element.style.setProperty("--label-border-style",String(e.border)),e!=null&&e.borderColor&&this.element.style.setProperty("--label-border-color",String(e.borderColor)),(e==null?void 0:e.borderWidth)!==void 0&&this.element.style.setProperty("--label-border-width",String(e.borderWidth)+"px"),document.body.appendChild(this.element),e.hoveredOpacity!==void 0&&(this.hoverListener=this.hoverHandler,document.addEventListener("mousemove",this.hoverListener))}remove(){this.hoverListener&&document.removeEventListener("mousemove",this.hoverListener),this.element&&(document.body.removeChild(this.element),this.element=null)}}class E{constructor(){s(this,"element",null);s(this,"originalElements",null);s(this,"originalUrl",null);s(this,"fallbackUrl","/favicon.ico");s(this,"emptyUrl","data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=");s(this,"size",32);s(this,"reset",()=>{});s(this,"singleElementMode",!1);s(this,"baseImage",null);s(this,"update",e=>{this.reset(),!e||e.iconStyle==="none"?this.restore():(this.backup(),this.render(e))});s(this,"restore",()=>{var e;this.singleElementMode&&this.element&&this.originalUrl&&this.setElementUrl(this.element,this.originalUrl),this.singleElementMode||(this.element&&(this.setElementUrl(this.element,this.emptyUrl),this.element.remove(),this.element=null),(e=this.originalElements)==null||e.forEach(t=>document.head.appendChild(t)),this.originalElements=null),this.baseImage=null});s(this,"backup",()=>{if(!this.singleElementMode&&this.originalElements===null){const e=document.querySelectorAll('link[rel*="icon"], link[rel="manifest"]');this.originalElements=Array.from(e).map(t=>t.cloneNode(!0)),e.forEach(t=>t.remove())}});s(this,"render",async e=>{const t=document.createElement("canvas");t.width=this.size,t.height=this.size;const i=t.getContext("2d");if(!i)throw new Error("Canvas context not available");try{this.baseImage?i.putImageData(this.baseImage,0,0):(await this.drawBase(i),this.baseImage=i.getImageData(0,0,t.width,t.height)),this.drawLabel(i,e),this.applyToElement(t.toDataURL())}catch{this.reset=()=>{}}})}bindIconElement(e){this.element=e,this.originalUrl=this.getElementUrl(e),this.singleElementMode=!0}drawBase(e){return new Promise((t,i)=>{var l,a;this.reset=i;const n=new Image;n.crossOrigin="anonymous",n.onload=()=>{e.drawImage(n,0,0,this.size,this.size),this.reset=()=>{},t()},n.onerror=()=>{if(n.src===this.fallbackUrl)e.fillStyle="transparent",e.fillRect(0,0,this.size,this.size),this.reset=()=>{},t();else{const h=new Image;h.crossOrigin="anonymous",h.onload=()=>{e.drawImage(h,0,0,this.size,this.size),this.reset=()=>{},t()},h.onerror=()=>{e.fillStyle="transparent",e.fillRect(0,0,this.size,this.size),this.reset=()=>{},t()},h.src=this.fallbackUrl}},n.src=this.originalUrl??((a=(l=this.originalElements)==null?void 0:l.find(h=>h.rel.includes("icon")))==null?void 0:a.href)??this.fallbackUrl})}drawLabel(e,t){switch(t.shape){case"triangle":this.drawLabelTriangle(e,t);break;case"ribbon":this.drawLabelRibbon(e,t);break;case"banner":this.drawLabelBanner(e,t);break;case"block":this.drawLabelBlock(e,t);break;case"frame":this.drawLabelFrame(e,t);break}}drawLabelTriangle(e,t){e.fillStyle=t.bgColor,e.beginPath();const i=.7;switch(t.position){case"left-top":e.moveTo(0,0),e.lineTo(i*this.size,0),e.lineTo(0,i*this.size);break;case"right-top":e.moveTo(this.size,0),e.lineTo((1-i)*this.size,0),e.lineTo(this.size,i*this.size);break;case"right-bottom":e.moveTo(this.size,this.size),e.lineTo((1-i)*this.size,this.size),e.lineTo(this.size,(1-i)*this.size);break;case"left-bottom":e.moveTo(0,this.size),e.lineTo(i*this.size,this.size),e.lineTo(0,(1-i)*this.size);break}e.closePath(),e.fill()}drawLabelRibbon(e,t){e.strokeStyle=t.bgColor,e.lineWidth=.3*this.size;const i=.7;switch(e.beginPath(),t.position){case"left-top":e.moveTo(0,this.size*i),e.lineTo(this.size*i,0);break;case"right-top":e.moveTo(this.size*(1-i),0),e.lineTo(this.size,this.size*i);break;case"right-bottom":e.moveTo(this.size,this.size*(1-i)),e.lineTo(this.size*(1-i),this.size);break;case"left-bottom":e.moveTo(0,this.size*(1-i)),e.lineTo(this.size*i,this.size);break}e.stroke()}drawLabelBanner(e,t){e.strokeStyle=t.bgColor;const i=.3*this.size;switch(e.lineWidth=i,e.beginPath(),t.position){case"left-top":e.moveTo(0,i/2),e.lineTo(this.size,i/2);break;case"right-top":e.moveTo(this.size-i/2,0),e.lineTo(this.size-i/2,this.size);break;case"right-bottom":e.moveTo(this.size,this.size-i/2),e.lineTo(0,this.size-i/2);break;case"left-bottom":e.moveTo(i/2,0),e.lineTo(i/2,this.size);break}e.stroke()}drawLabelBlock(e,t){e.strokeStyle=t.bgColor;const i=.3*this.size;switch(e.lineWidth=i,e.beginPath(),t.position){case"left-top":e.moveTo(0,i/2),e.lineTo(this.size,i/2);break;case"right-top":e.moveTo(this.size-i/2,0),e.lineTo(this.size-i/2,this.size);break;case"right-bottom":e.moveTo(this.size,this.size-i/2),e.lineTo(0,this.size-i/2);break;case"left-bottom":e.moveTo(i/2,0),e.lineTo(i/2,this.size);break}e.stroke()}drawLabelFrame(e,t){e.strokeStyle=t.bgColor;const i=.1*this.size;e.lineWidth=i,e.strokeRect(i/2,i/2,this.size-i,this.size-i),e.stroke()}getElementUrl(e){return e instanceof HTMLLinkElement?e.href:e.src}setElementUrl(e,t){e instanceof HTMLLinkElement?e.href=t:e.src=t}applyToElement(e){if(this.element)this.setElementUrl(this.element,e);else{const t=document.createElement("link");t.id="webLabelerFavicon",t.rel="icon",t.href=e;const i=document.head||document.getElementsByTagName("head")[0];this.element=i.appendChild(t)}}}const m=new f,c=new w,d=new E;m.subscribe(c.update.bind(c));m.subscribe(d.update.bind(d));m.init();
